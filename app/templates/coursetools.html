{% extends "layout.html" %}

{% block title %}Kurssityökalut{% endblock %}
{% block content %}
<h2>Luo kurssi</h2>
<form action="/createcourse" method="POST">
    <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}">
    <label for="course_name">Kurssin nimi:</label>
    <input name="course_name" type="text" minlength="1" required>
    <br>
    <label for="credits">Opintopisteet:</label>
    <input name="credits" type="number" style="width: 35px" value="5" min="0" max="10" required>
    <br>
    <input type="submit" value="Luo kurssi">
    {% if request.args.get("status") == "success" %}
    <p>Kurssi {{ request.args.get("name") }} luotu onnistuneesti!</p>
    {% endif %}
    {% if request.args.get("status") == "fail" %}
    <p>Kurssin luonti epäonnistui, yritä uudelleen.</p>
    {% endif %}
    {% if request.args.get("status") == "already_exists" %}
    <p>Kurssi {{ request.args.get("name") }} on jo olemassa!</p>
    {% endif %}
</form>
<hr>
<h2>Lista kursseista</h2>
{% if request.args.get("status") == "deleted" %}
<b>Kurssi {{ request.args.get("name") }} poistettu onnistuneesti!</b>
{% elif request.args.get("status") == "course_not_deletable" %}
<b>Kurssia ei ole olemassa, joten sitä ei voi poistaa!</b>
{% endif %}

{% if courses|length == 0 %}
<h3>Kurssilista on tyhjä.</h3>
{% else %}
<table>
    <thead>
        <tr>
            <th><b>Kurssi</b></th>
            <th><b>Opintopisteet</b></th>
            <th><b>Opettaja</b></th>
            <th><b>Opiskelijoita</b></th>
            <th colspan="2"></th>
        </tr>
    </thead>
    <tbody>
        {% for course in courses %}
        <tr>
            <td>{{ course["name"] }}</td>
            <td>{{ course["credits"] }}</td>
            <td>{{ course["username"] }}</td>
            {% if course["student_count"] is none %}
            <td>0</td>
            {% else %}
            <td>{{ course["student_count"] }}</td>
            {% endif %}
            {% if session["username"] == course["username"] %}
            <td><a href="/deletecourse?id={{course[0]}}" style="color: red">Poista kurssi</a></td>
            <td><a href="/modifycourse?id={{course[0]}}">Muokkaa kurssia</a></td>
            {% endif %}
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endif %}
{% endblock %}
