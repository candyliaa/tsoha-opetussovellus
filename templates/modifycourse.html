{% extends "layout.html" %}
{% block title %}Kurssin muokkaus{% endblock %}

{% block content %}
<h2>Valittu kurssi: {{ course["name"] }} ({{ course["credits"] }} op)</h2>
{% if course_exercises|length == 0 %}
<h3>Kurssilla ei ole tehtäviä.</h3>
{% else %}
<h3>Tehtäviä: {{ course_exercises|length }}</h3>
{% endif %}
<button onclick="openForm()">Lisää tehtävä </button>
<button onclick="listExercises()">Listaa tehtävät</button>
<div id="list-exercises" style="display: none">
    <h3>Tekstitehtävät</h3>
</div>
<div id="exerciseform" style="display: none">
    <br>
    <button onclick="openTextExercise()">Tekstitehtävä</button>
    <button onclick="openMultipleChoiceExercise()">Monivalintatehtävä</button>
</div>
<div style="display: none">
    <form action="/exercisecreated" id="textform" method="POST">
        <input type="hidden" name="course_id" value="{{ course['id'] }}">
        <input type="hidden" name="exercise_type" value="text_question">
        <label for="question">Tehtävän kysymys:</label>
        <br>
        <input name="question" type="text" minlength="1" required>
        <br>
        Mallivastaus:
        <br>
        <textarea name="example_answer" rows="3" cols="50"></textarea>
        <br>
        <input type="submit" value="Luo tehtävä">
    </form>
</div>
<div id="multiplechoiceform" style="display: none">
    <form onsubmit="submit()">
        <input type="hidden" name="course_id" value="{{ course['id'] }}">
        <label for="question">Tehtävän kysymys:</label>
        <br>
        <input name="question" type="text" minlength="1" required>
        <br>
        Valinnat:
        <br>
        <ul id="list-choices">
            <li><input type="checkbox" class="correct_answers" checked="true"><input name="choices[]" type="text" class="choices" required></li>
            <li><input type="checkbox" class="correct_answers"><input name="choices[]" type="text" class="choices" required ></li>
        </ul>
        <template id="choice-input-template">
            <li><input type="checkbox" class="correct_answers"><input type="text" name="choices[]" required></li>
        </template>
        <br>
        <button onclick="addChoice()">Lisää valinta</button>
        <input type="submit" value="Luo tehtävä">
    </form>
</div>
<br style="line-height: 2">
<a href="/deletecourse?id={{course['id']}}" style="color: red">Poista kurssi</a>
<hr>
<h2>Tilastoja:</h2>
<!--Scripts for the buttons on this page-->
<script>
    function openForm() {
        const form = document.getElementById("exerciseform");
        if (form.style.display === "none") {
            form.style.display = "block";
        } else {
            form.style.display = "none";
        }
    }

    function openTextExercise() {
        var textForm = document.getElementById("textform");
        if (textForm.style.display === "none") {
            textForm.style.display = "block";
        } else {
            textForm.style.display = "none";
        }
        var multipleChoiceForm = document.getElementById("multiplechoiceform")
        if (multipleChoiceForm.style.display === "block") {
            multipleChoiceForm.style.display = "none"
        }
    }

    function openMultipleChoiceExercise() {
        var multipleChoiceForm = document.getElementById("multiplechoiceform");
        if (multipleChoiceForm.style.display === "none") {
            multipleChoiceForm.style.display = "block";
        } else {
            multipleChoiceForm.style.display = "none";
        }
        var textForm = document.getElementById("textform")
        if (textForm.style.display === "block") {
            textForm.style.display = "none"
        }
    }

    function addChoice() {
        const ul = document.getElementById("list-choices");
        const newChoice = document.getElementById("choice-input-template").content.cloneNode(true);
        ul.appendChild(newChoice);
    }

    function submit() {
        const question = document.getElementsByName("question").value;
        const choices = Array.from(document.getElementsByClassName("choices")).map(i => i.value);
        const correctAnswers = Array.from(document.getElementsByClassName("correct_answers")).map(i => i.checked);
        const course_id = document.getElementsByName("course_id").value;
        const formData = new FormData();
        formData.append("question", question);
        formData.append("choices", choices);
        formData.append("correct_answers", correctAnswers);
        formData.append("exercise_type", "multiple_choice");
        formData.append("course_id", course_id)
        fetch("/exercisecreated", { method: "POST", body: formData });
    }

    function listExercises() {
        const exerciseList = document.getElementById("list-exercises")
        if (exerciseList.style.display === "none") {
            exerciseList.style.display = "block";
        } else {
            exerciseList.style.display = "none"
        }
    }
</script>
{% endblock %}
